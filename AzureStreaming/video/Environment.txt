For our environment, we will need a Event Hub to which we can push data and a SQL Server database into which we can save our extracted data.

In the source code folder I have provided a powershell script to create the event hub and the database. Within the script, you will need to change the subscriptionid and the startip variables. The subscriptionid is your Azure subscription id and the startupip is the ip of your machine. The script will add a firewall rule to allow your machine to talk with sql server.

Run Script

Now as we can see we have a Event hub, a SQL Server and a database 

(click on SQL Server, then sql databases) called devicedb

(click on devicedb, then query editor at top, under overview)

Lets log into the query editor and create a table

CREATE TABLE [dbo].[AuditTable](
    [Id] [int] IDENTITY(1,1) NOT NULL,
    [device] [varchar](50) NULL,
    [tenant] [varchar](50) NULL,
    project [varchar](50) NULL,
    [username] [varchar](50) NULL,
    [action] [varchar](150) NULL,
    [tshirtcolor] [varchar](150) NULL,
    [EventEnqueuedUtcTime] [datetime] NULL
) ON [PRIMARY]

(expand tables and dbo.audittable)

Great we have a table called AuditTable where Azure Stream Analytics will pump data.